<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Data Tegangan dan Gambar</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
  .img-thumb {
    cursor: pointer;
    max-width: 80px;
    max-height: 80px;
    object-fit: cover;
  }
</style>
</head>
<body>
<div class="container py-3">
  <h1 class="mb-4">Data Tegangan dan Gambar</h1>
  <input id="searchInput" type="text" class="form-control mb-3" placeholder="Cari..." />
  <table class="table table-striped" id="dataTable">
    <thead><tr id="tableHeader"></tr></thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- Modal zoom gambar -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-body p-0">
        <img id="modalImage" src="" class="w-100" alt="Zoomed image" />
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const DATA_API_URL = "https://script.google.com/macros/s/AKfycbw19E_QkK4e3xzgEcv6dqnly0OcGL7Q78-8pslJo5GDsJ1oNfQKc1AHvqntaDUz7I0F/exec";

  let originalData = [];

  async function fetchData() {
    const res = await fetch(DATA_API_URL);
    originalData = await res.json();
    renderTable(originalData);
  }

  function renderTable(data) {
    const tableHeader = document.getElementById("tableHeader");
    const tableBody = document.getElementById("tableBody");
    tableHeader.innerHTML = "";
    tableBody.innerHTML = "";

    if (data.length === 0) {
      tableBody.innerHTML = "<tr><td colspan='100%'>Tidak ada data</td></tr>";
      return;
    }

    const headers = Object.keys(data[0]);
    headers.forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      tableHeader.appendChild(th);
    });

    data.forEach(row => {
      const tr = document.createElement("tr");
      headers.forEach(h => {
        const td = document.createElement("td");
        if (/link|foto|gambar/i.test(h) && row[h]) {
          const img = document.createElement("img");
          img.src = row[h];
          img.alt = "gambar";
          img.className = "img-thumb";
          img.addEventListener("click", () => {
            document.getElementById("modalImage").src = row[h];
            new bootstrap.Modal(document.getElementById("imageModal")).show();
          });
          td.appendChild(img);
        } else {
          td.textContent = row[h] ?? "-";
        }
        tr.appendChild(td);
      });
      tableBody.appendChild(tr);
    });
  }

  document.getElementById("searchInput").addEventListener("input", e => {
    const searchText = e.target.value.toLowerCase();
    const filtered = originalData.filter(row =>
      Object.values(row).some(val => val && val.toString().toLowerCase().includes(searchText))
    );
    renderTable(filtered);
  });

  window.onload = fetchData;
</script>
</body>
</html>
